\hypertarget{echo__server_8c}{}\section{src/echo\+\_\+server.c File Reference}
\label{echo__server_8c}\index{src/echo\+\_\+server.\+c@{src/echo\+\_\+server.\+c}}


Servidor echo utilizado para comprender y desarrollar el servidor I\+RC.  


{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$netdb.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$netinet/in.\+h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$pthread.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
Include dependency graph for echo\+\_\+server.\+c\+:
% FIG 0
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{echo__server_8c_aeca034f67218340ecb2261a22c2f3dcd}{B\+U\+F\+S\+I\+ZE}~1024
\item 
\#define \hyperlink{echo__server_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}~10
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{echo__server_8c_aad9796c174f7ef5d226cd169f2520fd5}{error} (char $\ast$\hyperlink{_g-2361-06-_p1-_server_8c_a32d2f5216cddb59c7cc8fb2806a7e727}{msg})
\item 
int \hyperlink{echo__server_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Servidor echo utilizado para comprender y desarrollar el servidor I\+RC. 

Servidor echo utilizado para comprender y desarrollar el servidor I\+RC con protocolo S\+SL.

\begin{DoxyAuthor}{Author}
Alfonso Sebares 

Beatriz de Pablo

Alfonso Sebares 

Beatriz de Pablo 

Celia Mateos

Alfonso Sebares 

Beatriz de Pablo 

Celia Mateos 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
28/04/17 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\index{echo\+\_\+server.\+c@{echo\+\_\+server.\+c}!B\+U\+F\+S\+I\+ZE@{B\+U\+F\+S\+I\+ZE}}
\index{B\+U\+F\+S\+I\+ZE@{B\+U\+F\+S\+I\+ZE}!echo\+\_\+server.\+c@{echo\+\_\+server.\+c}}
\subsubsection[{\texorpdfstring{B\+U\+F\+S\+I\+ZE}{BUFSIZE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define B\+U\+F\+S\+I\+ZE~1024}\hypertarget{echo__server_8c_aeca034f67218340ecb2261a22c2f3dcd}{}\label{echo__server_8c_aeca034f67218340ecb2261a22c2f3dcd}
Tam. max. del buffer que se lee \index{echo\+\_\+server.\+c@{echo\+\_\+server.\+c}!M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ@{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}}
\index{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ@{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}!echo\+\_\+server.\+c@{echo\+\_\+server.\+c}}
\subsubsection[{\texorpdfstring{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}{MAX_CON_REQ}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ~10}\hypertarget{echo__server_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{}\label{echo__server_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}
Max. de peticiones de conexion activas (e.\+g. la 11 falla si puesto a 10) 

\subsection{Function Documentation}
\index{echo\+\_\+server.\+c@{echo\+\_\+server.\+c}!error@{error}}
\index{error@{error}!echo\+\_\+server.\+c@{echo\+\_\+server.\+c}}
\subsubsection[{\texorpdfstring{error(char $\ast$msg)}{error(char *msg)}}]{\setlength{\rightskip}{0pt plus 5cm}void error (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{msg}
\end{DoxyParamCaption}
)}\hypertarget{echo__server_8c_aad9796c174f7ef5d226cd169f2520fd5}{}\label{echo__server_8c_aad9796c174f7ef5d226cd169f2520fd5}

\begin{DoxyCode}
24                       \{
25         perror(\hyperlink{_g-2361-06-_p1-_server_8c_a32d2f5216cddb59c7cc8fb2806a7e727}{msg});
26         exit(1);
27 \}
\end{DoxyCode}
\index{echo\+\_\+server.\+c@{echo\+\_\+server.\+c}!main@{main}}
\index{main@{main}!echo\+\_\+server.\+c@{echo\+\_\+server.\+c}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$argv[])}{main(int argc, char *argv[])}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}\hypertarget{echo__server_8c_a0ddf1224851353fc92bfbff6f499fa97}{}\label{echo__server_8c_a0ddf1224851353fc92bfbff6f499fa97}

\begin{DoxyCode}
30 \{
31         \textcolor{keywordtype}{int} socket\_desc , client\_sock , c , read\_size;
32         \textcolor{keywordtype}{int} portno;
33         \textcolor{keywordtype}{int} optval; \textcolor{comment}{/* flag value for setsockopt */}
34         \textcolor{keyword}{struct }sockaddr\_in server , client;
35         \textcolor{keyword}{struct }hostent *hostp; \textcolor{comment}{/* client host info */}
36         \textcolor{keywordtype}{char} client\_message[\hyperlink{echo__server_8c_aeca034f67218340ecb2261a22c2f3dcd}{BUFSIZE}];
37         \textcolor{keywordtype}{char} *hostaddrp; \textcolor{comment}{/* dotted decimal host addr string */}
38          
39         \textcolor{keywordflow}{if} (argc != 2) \{
40                 fprintf(stderr, \textcolor{stringliteral}{"usage: %s <port>\(\backslash\)n"}, argv[0]);
41                 exit(1);
42         \}
43         portno = atoi(argv[1]);
44         
45         \textcolor{comment}{//Create socket}
46         socket\_desc = socket(AF\_INET , SOCK\_STREAM , 0);
47         \textcolor{keywordflow}{if} (socket\_desc == -1)
48         \{
49                 printf(\textcolor{stringliteral}{"Could not create socket"});
50         \}
51         puts(\textcolor{stringliteral}{"Socket created"});
52         
53         optval = 1;
54         setsockopt(socket\_desc, SOL\_SOCKET, SO\_REUSEADDR, (\textcolor{keyword}{const} \textcolor{keywordtype}{void} *)&optval , \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
55 
56         \textcolor{comment}{//Prepare the sockaddr\_in structure}
57         memset((\textcolor{keywordtype}{char} *) &server, 0, \textcolor{keyword}{sizeof}(server));
58         server.sin\_family = AF\_INET;
59         server.sin\_addr.s\_addr = INADDR\_ANY;
60         server.sin\_port = htons((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short})portno );
61          
62         \textcolor{comment}{//Bind}
63         \textcolor{keywordflow}{if}( bind(socket\_desc,(\textcolor{keyword}{struct} sockaddr *)&server , \textcolor{keyword}{sizeof}(server)) < 0)
64         \{
65                 \textcolor{comment}{//print the error message}
66                 \textcolor{comment}{//printf("\(\backslash\)nstrerror: %s\(\backslash\)n", strerror(errno));}
67                 perror(\textcolor{stringliteral}{"bind failed. Error"});
68                 \textcolor{keywordflow}{return} 1;
69         \}
70         puts(\textcolor{stringliteral}{"bind done"});
71          
72         \textcolor{comment}{//Listen}
73         listen(socket\_desc , \hyperlink{echo__server_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{MAX\_CON\_REQ});
74          
75         \textcolor{comment}{//Accept and incoming connection}
76         puts(\textcolor{stringliteral}{"Waiting for incoming connections..."});
77         c = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in);
78          
79         \textcolor{comment}{//accept connection from an incoming client}
80         client\_sock = accept(socket\_desc, (\textcolor{keyword}{struct} sockaddr *)&client, (socklen\_t*)&c);
81         \textcolor{keywordflow}{if} (client\_sock < 0)
82         \{
83                 perror(\textcolor{stringliteral}{"accept failed"});
84                 \textcolor{keywordflow}{return} 1;
85         \}
86 
87         hostp = gethostbyaddr((\textcolor{keyword}{const} \textcolor{keywordtype}{char} *)&client.sin\_addr.s\_addr, \textcolor{keyword}{sizeof}(client.sin\_addr.s\_addr), 
      AF\_INET);
88         \textcolor{keywordflow}{if} (hostp == NULL)
89                 \hyperlink{echo__server_8c_aad9796c174f7ef5d226cd169f2520fd5}{error}(\textcolor{stringliteral}{"ERROR on gethostbyaddr"});
90 
91         hostaddrp = inet\_ntoa(client.sin\_addr);
92 
93         \textcolor{keywordflow}{if} (hostaddrp == NULL)
94                 \hyperlink{echo__server_8c_aad9796c174f7ef5d226cd169f2520fd5}{error}(\textcolor{stringliteral}{"ERROR on inet\_ntoa\(\backslash\)n"});
95         printf(\textcolor{stringliteral}{"\(\backslash\)nserver established connection with %s (%s)\(\backslash\)n"}, hostp->h\_name, hostaddrp);
96          
97         \textcolor{comment}{//Receive a message from client}
98         \textcolor{keywordflow}{while}( strcmp(client\_message, \textcolor{stringliteral}{"\_STOP\_"}) != 0 )
99         \{
100                 read\_size = recv(client\_sock , client\_message , \hyperlink{echo__server_8c_aeca034f67218340ecb2261a22c2f3dcd}{BUFSIZE} , 0);
101                 printf(\textcolor{stringliteral}{"\(\backslash\)nRecibido: %s"}, client\_message);
102                 \textcolor{keywordflow}{if} (read\_size < 0)\{
103                         perror(\textcolor{stringliteral}{"recv failed"});
104                 \}
105                 \textcolor{comment}{//Send the message back to client}
106                 \textcolor{comment}{//write(client\_sock , client\_message , read\_size);}
107                 \textcolor{comment}{/*afinar un poco mas que mandar siempre BUFSIZE:*/}
108                 write(client\_sock , client\_message , strlen(client\_message)+1); 
109         \}
110         
111         puts(\textcolor{stringliteral}{"Client disconnected"});
112         fflush(stdout);
113         close(client\_sock);
114          
115         \textcolor{keywordflow}{return} 0;
116 \}\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 1


