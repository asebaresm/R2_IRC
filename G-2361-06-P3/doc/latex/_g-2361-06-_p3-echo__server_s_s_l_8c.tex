\hypertarget{_g-2361-06-_p3-echo__server_s_s_l_8c}{}\section{src/\+G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+SL.c File Reference}
\label{_g-2361-06-_p3-echo__server_s_s_l_8c}\index{src/\+G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{src/\+G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}}
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$netdb.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$netinet/in.\+h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$pthread.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include \char`\"{}../includes/\+G-\/2361-\/06-\/\+P3-\/funciones\+\_\+ssl.\+h\char`\"{}}\\*
Include dependency graph for G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+SL.c\+:
% FIG 0
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_aeca034f67218340ecb2261a22c2f3dcd}{B\+U\+F\+S\+I\+ZE}~1024
\item 
\#define \hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}~10
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_aad9796c174f7ef5d226cd169f2520fd5}{error} (char $\ast$msg)
\item 
int \hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}!B\+U\+F\+S\+I\+ZE@{B\+U\+F\+S\+I\+ZE}}
\index{B\+U\+F\+S\+I\+ZE@{B\+U\+F\+S\+I\+ZE}!G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}}
\subsubsection[{\texorpdfstring{B\+U\+F\+S\+I\+ZE}{BUFSIZE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define B\+U\+F\+S\+I\+ZE~1024}\hypertarget{_g-2361-06-_p3-echo__server_s_s_l_8c_aeca034f67218340ecb2261a22c2f3dcd}{}\label{_g-2361-06-_p3-echo__server_s_s_l_8c_aeca034f67218340ecb2261a22c2f3dcd}
Tam. max. del buffer que se lee \index{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}!M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ@{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}}
\index{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ@{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}!G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}}
\subsubsection[{\texorpdfstring{M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ}{MAX_CON_REQ}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+C\+O\+N\+\_\+\+R\+EQ~10}\hypertarget{_g-2361-06-_p3-echo__server_s_s_l_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{}\label{_g-2361-06-_p3-echo__server_s_s_l_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}
Max. de peticiones de conexion activas (e.\+g. la 11 falla si puesto a 10) 

\subsection{Function Documentation}
\index{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}!error@{error}}
\index{error@{error}!G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}}
\subsubsection[{\texorpdfstring{error(char $\ast$msg)}{error(char *msg)}}]{\setlength{\rightskip}{0pt plus 5cm}void error (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{msg}
\end{DoxyParamCaption}
)}\hypertarget{_g-2361-06-_p3-echo__server_s_s_l_8c_aad9796c174f7ef5d226cd169f2520fd5}{}\label{_g-2361-06-_p3-echo__server_s_s_l_8c_aad9796c174f7ef5d226cd169f2520fd5}

\begin{DoxyCode}
27                       \{
28         perror(msg);
29         exit(1);
30 \}
\end{DoxyCode}
\index{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}!main@{main}}
\index{main@{main}!G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c@{G-\/2361-\/06-\/\+P3-\/echo\+\_\+server\+S\+S\+L.\+c}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$argv[])}{main(int argc, char *argv[])}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}\hypertarget{_g-2361-06-_p3-echo__server_s_s_l_8c_a0ddf1224851353fc92bfbff6f499fa97}{}\label{_g-2361-06-_p3-echo__server_s_s_l_8c_a0ddf1224851353fc92bfbff6f499fa97}

\begin{DoxyCode}
33 \{
34         \textcolor{keywordtype}{int} socket\_desc , client\_sock , c , read\_size;
35         \textcolor{keywordtype}{int} portno;
36         \textcolor{keywordtype}{int} optval; \textcolor{comment}{/* flag value for setsockopt */}
37         \textcolor{keyword}{struct }sockaddr\_in server , client;
38         \textcolor{keyword}{struct }hostent *hostp; \textcolor{comment}{/* client host info */}
39         \textcolor{keywordtype}{char} client\_message[\hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_aeca034f67218340ecb2261a22c2f3dcd}{BUFSIZE}];
40         \textcolor{keywordtype}{char} *hostaddrp; \textcolor{comment}{/* dotted decimal host addr string */}
41         SSL\_CTX* ctx=NULL;
42         SSL * ssl=NULL;
43          
44         portno = 8888;
45         
46         \hyperlink{_g-2361-06-_p3-funciones__ssl_8h_a937108af8fd0832377b084e24172ee41}{inicializar\_nivel\_SSL}();
47         ctx=\hyperlink{_g-2361-06-_p3-funciones__ssl_8h_a9d58ced0f4bab693b1c8d8b7eabe10a2}{fijar\_contexto\_SSL}(\hyperlink{_g-2361-06-_p3-funciones__ssl_8h_a99a438eb7c7b1f8f8860e65f8818d152}{SERVER\_CERT}, 
      \hyperlink{_g-2361-06-_p3-funciones__ssl_8h_a407c2e21300d77cb31c5c30b37324c87}{SERVER\_KEY});
48 
49         \textcolor{comment}{//Create socket}
50         socket\_desc = socket(AF\_INET , SOCK\_STREAM , 0);
51         \textcolor{keywordflow}{if} (socket\_desc == -1)
52         \{
53                 perror(\textcolor{stringliteral}{"Could not create socket"});
54                 \textcolor{keywordflow}{return} 1;
55         \}
56         
57         optval = 1;
58         setsockopt(socket\_desc, SOL\_SOCKET, SO\_REUSEADDR, (\textcolor{keyword}{const} \textcolor{keywordtype}{void} *)&optval , \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));
59 
60         \textcolor{comment}{//Prepare the sockaddr\_in structure}
61         memset((\textcolor{keywordtype}{char} *) &server, 0, \textcolor{keyword}{sizeof}(server));
62         server.sin\_family = AF\_INET;
63         server.sin\_addr.s\_addr = INADDR\_ANY;
64         server.sin\_port = htons((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short})portno );
65          
66         \textcolor{comment}{//Bind}
67         \textcolor{keywordflow}{if}( bind(socket\_desc,(\textcolor{keyword}{struct} sockaddr *)&server , \textcolor{keyword}{sizeof}(server)) < 0)
68         \{
69                 \textcolor{comment}{//print the error message}
70                 \textcolor{comment}{//printf("\(\backslash\)nstrerror: %s\(\backslash\)n", strerror(errno));}
71                 perror(\textcolor{stringliteral}{"bind failed. Error"});
72                 \textcolor{keywordflow}{return} 1;
73         \}
74          
75         \textcolor{comment}{//Listen}
76         listen(socket\_desc , \hyperlink{_g-2361-06-_p3-echo__server_s_s_l_8c_a3e4b4faa36cc9e3a7d9895aec8f27592}{MAX\_CON\_REQ});
77 
78         \textcolor{comment}{//Accept and incoming connection}
79         c = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in);
80          
81         \textcolor{comment}{//accept connection from an incoming client}
82         client\_sock = accept(socket\_desc, (\textcolor{keyword}{struct} sockaddr *)&client, (socklen\_t*)&c);
83         \textcolor{keywordflow}{if} (client\_sock < 0)
84         \{
85                 perror(\textcolor{stringliteral}{"accept failed"});
86                 \textcolor{keywordflow}{return} 1;
87         \}
88 
89         hostp = gethostbyaddr((\textcolor{keyword}{const} \textcolor{keywordtype}{char} *)&client.sin\_addr.s\_addr, \textcolor{keyword}{sizeof}(client.sin\_addr.s\_addr), 
      AF\_INET);
90         \textcolor{keywordflow}{if} (hostp == NULL)\{
91                 perror(\textcolor{stringliteral}{"ERROR on gethostbyaddr"});
92                 \textcolor{keywordflow}{return} 1;
93         \}
94 
95         hostaddrp = inet\_ntoa(client.sin\_addr);
96 
97         \textcolor{keywordflow}{if} (hostaddrp == NULL)\{
98                 perror(\textcolor{stringliteral}{"ERROR on inet\_ntoa\(\backslash\)n"});
99                 \textcolor{keywordflow}{return} 1;
100         \}
101         printf(\textcolor{stringliteral}{"\(\backslash\)nserver established connection with %s (%s)\(\backslash\)n"}, hostp->h\_name, hostaddrp);
102         
103         ssl=\hyperlink{_g-2361-06-_p3-funciones__ssl_8h_aaeb9457077403f2261ca1a86e3802a1d}{aceptar\_canal\_seguro\_SSL}(ctx, client\_sock); 
104 
105         \textcolor{comment}{//Receive a message from client}
106         \textcolor{keywordflow}{while}( strcmp(client\_message, \textcolor{stringliteral}{"exit"}) != 0 )
107         \{
108 
109                 read\_size = \hyperlink{_g-2361-06-_p3-funciones__ssl_8h_adc12a32e9564947c310da53ed910d66a}{recibir\_datos\_SSL}(ssl, client\_message);
110                 \textcolor{keywordflow}{if} (read\_size < 0)\{
111                         \textcolor{keywordflow}{break};
112                 \}
113 
114                 \textcolor{keywordflow}{if} (\hyperlink{_g-2361-06-_p3-funciones__ssl_8h_a259d64855c617836e2b18975ee98029a}{enviar\_datos\_SSL}(ssl, client\_message) < 0)
115                         \textcolor{keywordflow}{break}; 
116 
117                 puts(client\_message);
118                 fflush(stdout);
119                 
120         \}
121         
122         \hyperlink{_g-2361-06-_p3-funciones__ssl_8h_af96fb6c9c2330e21ab617e949acf7a8c}{cerrar\_canal\_SSL}(&ssl, &ctx, client\_sock);
123         fflush(stdout);
124         close(client\_sock);
125         close(socket\_desc); 
126 
127         \textcolor{keywordflow}{return} 0;
128 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 1


